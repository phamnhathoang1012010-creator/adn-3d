<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
<title>DNA 3D</title>

<style>
html, body {
  margin: 0;
  padding: 0;
  width: 100%;
  height: 100%;
  overflow: hidden;
  background: black;
}

#scene {
  position: fixed;
  inset: 0;
  width: 100vw;
  height: 100vh;
}

canvas { display: block; }

#ui {
  position: fixed;
  top: 10px;
  width: 100%;
  display: flex;
  justify-content: center;
  gap: 10px;
  z-index: 10;
}

button {
  background: #222;
  color: white;
  border: 1px solid #555;
  border-radius: 10px;
  padding: 10px 18px;
  font-size: 16px;
}
</style>
</head>

<body>
<div id="scene"></div>

<div id="ui">
  <button onclick="setMode('xoan')">Xoắn</button>
  <button onclick="setMode('thao')">Tháo</button>
  <button onclick="setMode('nhandoi')">Nhân đôi</button>
</div>

<script src="https://cdn.jsdelivr.net/npm/three@0.152/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.152/examples/js/controls/OrbitControls.js"></script>

<script>
const container = document.getElementById("scene");

const scene = new THREE.Scene();
scene.background = new THREE.Color(0x000000);

const camera = new THREE.PerspectiveCamera(
  60,
  window.innerWidth / window.innerHeight,
  0.1,
  1000
);
camera.position.set(0, 0, 40);

const renderer = new THREE.WebGLRenderer({ antialias: true });
renderer.setPixelRatio(window.devicePixelRatio);
renderer.setSize(window.innerWidth, window.innerHeight);
container.appendChild(renderer.domElement);

const controls = new THREE.OrbitControls(camera, renderer.domElement);
controls.enableDamping = true;
controls.enablePan = false;

// ÁNH SÁNG
scene.add(new THREE.AmbientLight(0xffffff, 0.8));
const light = new THREE.DirectionalLight(0xffffff, 1);
light.position.set(10, 20, 20);
scene.add(light);

// ===== ADN =====
const dna = new THREE.Group();
scene.add(dna);

const baseColors = {
  A: 0xff4444,
  T: 0x44aaff,
  G: 0x44ff88,
  C: 0xffcc44
};

const bases = ["A", "T", "G", "C"];
const pairs = 24;
const radius = 6;
const step = 1.2;

const leftStrand = [];
const rightStrand = [];
const bonds = [];

for (let i = 0; i < pairs; i++) {
  const angle = i * 0.5;
  const y = (i - pairs / 2) * step;

  const b1 = bases[Math.floor(Math.random()*4)];
  const b2 = (b1 === "A") ? "T" : (b1 === "T") ? "A" : (b1 === "G") ? "C" : "G";

  const mat1 = new THREE.MeshStandardMaterial({ color: baseColors[b1] });
  const mat2 = new THREE.MeshStandardMaterial({ color: baseColors[b2] });

  const sphere = new THREE.SphereGeometry(0.5, 16, 16);

  const p1 = new THREE.Mesh(sphere, mat1);
  const p2 = new THREE.Mesh(sphere, mat2);

  p1.position.set(Math.cos(angle)*radius, y, Math.sin(angle)*radius);
  p2.position.set(-Math.cos(angle)*radius, y, -Math.sin(angle)*radius);

  dna.add(p1, p2);
  leftStrand.push(p1);
  rightStrand.push(p2);

  // Liên kết hydro
  const bondGeo = new THREE.CylinderGeometry(0.08, 0.08, radius*2, 8);
  const bondMat = new THREE.MeshBasicMaterial({ color: 0x66ffff });
  const bond = new THREE.Mesh(bondGeo, bondMat);
  bond.position.y = y;
  bond.rotation.z = Math.PI / 2;
  dna.add(bond);
  bonds.push(bond);
}

let mode = "xoan";

function setMode(m) {
  mode = m;
}

// ===== ANIMATION =====
function animate() {
  requestAnimationFrame(animate);

  if (mode === "xoan") {
    dna.rotation.y += 0.005;
  }

  if (mode === "thao") {
    leftStrand.forEach(p => p.position.x -= 0.03);
    rightStrand.forEach(p => p.position.x += 0.03);
    bonds.forEach(b => b.visible = false);
  }

  if (mode === "nhandoi") {
    leftStrand.forEach(p => p.position.x -= 0.01);
    rightStrand.forEach(p => p.position.x += 0.01);
  }

  controls.update();
  renderer.render(scene, camera);
}

animate();

// ===== FIX TRẮNG / ĐEN MÀN HÌNH =====
function onResize() {
  camera.aspect = window.innerWidth / window.innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(window.innerWidth, window.innerHeight);
}
window.addEventListener("resize", onResize);
window.addEventListener("orientationchange", onResize);
</script>
</body>
</html>
