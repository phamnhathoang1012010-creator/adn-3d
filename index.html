<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>ADN 3D Mode</title>
<style>
body{margin:0;background:black;color:white;font-family:Arial;text-align:center}
button{margin:6px;padding:10px 16px;border-radius:20px;border:none;background:#222;color:white}
button.active{background:#0aa}
input{width:300px}
</style>
</head>
<body>

<h3>üß¨ ADN ‚Äì MODO 3D</h3>

<div>
  <button onclick="setMode(1,this)">Xo·∫Øn k√©p 3D</button>
  <button onclick="setMode(2,this)">Th√°o xo·∫Øn 3D</button>
  <button onclick="setMode(3,this)">Nh√¢n ƒë√¥i 3D</button>
</div>

<input type="range" id="slider" min="0" max="100" value="0">

<script src="https://unpkg.com/three@0.158.0/build/three.min.js"></script>
<script>
let scene,camera,renderer,mode=1;
let dna=[],enzyme,polymerase;
const slider=document.getElementById("slider");

init();
setMode(1,document.querySelector("button"));
animate();

function init(){
  scene=new THREE.Scene();
  camera=new THREE.PerspectiveCamera(60,innerWidth/innerHeight,0.1,1000);
  camera.position.z=45;

  renderer=new THREE.WebGLRenderer({antialias:true});
  renderer.setSize(innerWidth,innerHeight);
  document.body.appendChild(renderer.domElement);

  const light=new THREE.PointLight(0xffffff,1);
  light.position.set(30,40,50);
  scene.add(light);
}

function clearScene(){
  while(scene.children.length>1) scene.remove(scene.children[1]);
  dna=[];
}

function sphere(color){
  return new THREE.Mesh(
    new THREE.SphereGeometry(0.8,16,16),
    new THREE.MeshStandardMaterial({color})
  );
}

function setMode(m,btn){
  mode=m;
  slider.value=0;
  clearScene();
  document.querySelectorAll("button").forEach(b=>b.classList.remove("active"));
  btn.classList.add("active");

  if(m===1)helix3D();
  if(m===2)unzip3D();
  if(m===3)replicate3D();
}

/* ===== NH√ÅNH 1 ===== */
function helix3D(){
  for(let i=0;i<24;i++){
    let a=i*0.4;
    let s1=sphere(0xff4444);
    let s2=sphere(0x44ff44);
    s1.position.set(Math.cos(a)*5,i-12,Math.sin(a)*5);
    s2.position.set(Math.cos(a+Math.PI)*5,i-12,Math.sin(a+Math.PI)*5);
    scene.add(s1,s2);
    dna.push(s1,s2);
  }
}

/* ===== NH√ÅNH 2 ===== */
function unzip3D(){
  for(let i=0;i<24;i++){
    let a=sphere(0x4488ff);
    let b=sphere(0xffcc33);
    a.position.set(-3,i-12,0);
    b.position.set(3,i-12,0);
    scene.add(a,b);
    dna.push({a,b});
  }
  enzyme=new THREE.Mesh(
    new THREE.BoxGeometry(8,1.2,2),
    new THREE.MeshStandardMaterial({color:0xff8800})
  );
  scene.add(enzyme);
}

/* ===== NH√ÅNH 3 ===== */
function replicate3D(){
  for(let i=0;i<24;i++){
    let s=sphere(0xff4444);
    s.position.set(-3,i-12,0);
    scene.add(s);
    dna.push(s);
  }
  polymerase=new THREE.Mesh(
    new THREE.BoxGeometry(3,1.2,2),
    new THREE.MeshStandardMaterial({color:0x00ffff})
  );
  scene.add(polymerase);
}

function animate(){
  requestAnimationFrame(animate);
  const t=slider.value/100;

  if(mode===1){
    scene.rotation.y=t*Math.PI*2;
    scene.scale.set(0.6+t,0.6+t,0.6+t);
  }

  if(mode===2){
    let cut=Math.floor(t*24);
    dna.forEach((p,i)=>{
      p.a.position.x=i<cut?-7:-3;
      p.b.position.x=i<cut?7:3;
    });
    enzyme.position.y=cut-12;
  }

  if(mode===3){
    let build=Math.floor(t*24);
    polymerase.position.y=build-12;

    dna.forEach((s,i)=>{
      if(i<build && !s.clone){
        let c=sphere(0x44ff44);
        c.position.set(3,i-12,0);
        scene.add(c);
        s.clone=c;
      }
      if(i>=build && s.clone){
        scene.remove(s.clone);
        s.clone=null;
      }
    });
  }

  renderer.render(scene,camera);
}
</script>
</body>
</html>
