<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>ADN 3D</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body { margin:0; overflow:hidden; background:black; }
#ui {
  position:fixed; top:10px; left:50%;
  transform:translateX(-50%);
  display:flex; gap:10px; z-index:10;
}
button {
  padding:10px 16px;
  background:#222; color:#fff;
  border:1px solid #555;
  border-radius:10px;
}
</style>
</head>

<body>
<div id="ui">
  <button onclick="mode='twist'">Xoắn</button>
  <button onclick="mode='open'">Tháo</button>
  <button onclick="mode='copy'">Nhân đôi</button>
</div>

<script src="https://cdn.jsdelivr.net/npm/three@0.152.2/build/three.min.js"></script>

<script>
/* ===== SCENE ===== */
const scene = new THREE.Scene();
const camera = new THREE.PerspectiveCamera(75, innerWidth/innerHeight, 0.1, 1000);
camera.position.z = 28;

const renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(innerWidth, innerHeight);
document.body.appendChild(renderer.domElement);

/* ===== LIGHT ===== */
scene.add(new THREE.AmbientLight(0xffffff, 0.6));
const light = new THREE.PointLight(0xffffff, 1);
light.position.set(20,20,20);
scene.add(light);

/* ===== DNA GROUP ===== */
const dna = new THREE.Group();
scene.add(dna);

const chainA = [], chainB = [], bonds = [];
const baseGeo = new THREE.SphereGeometry(0.45, 16, 16);

/* ===== BASE COLORS ===== */
const colors = {
  A: 0xff4444,
  T: 0x44aaff,
  G: 0x44ff88,
  C: 0xffcc44
};
const bases = ["A","T","G","C"];

const R = 6;        // khoảng cách 2 mạch
const STEP = 0.45;

/* ===== CREATE DNA ===== */
for(let i=0;i<40;i++){
  const angle = i*STEP;
  const y = i*0.5 - 10;

  const b1 = bases[Math.floor(Math.random()*4)];
  const b2 = (b1==="A")?"T":(b1==="T")?"A":(b1==="G")?"C":"G";

  const m1 = new THREE.Mesh(
    baseGeo,
    new THREE.MeshStandardMaterial({color:colors[b1]})
  );
  const m2 = new THREE.Mesh(
    baseGeo,
    new THREE.MeshStandardMaterial({color:colors[b2]})
  );

  m1.position.set(Math.cos(angle)*R, y, Math.sin(angle)*R);
  m2.position.set(Math.cos(angle+Math.PI)*R, y, Math.sin(angle+Math.PI)*R);

  dna.add(m1); dna.add(m2);
  chainA.push(m1); chainB.push(m2);

  /* ===== HYDROGEN BOND ===== */
  const bondGeo = new THREE.CylinderGeometry(0.06,0.06,1,8);
  const bondMat = new THREE.MeshStandardMaterial({
    color:0xffffff,
    transparent:true,
    opacity:0.9
  });
  const bond = new THREE.Mesh(bondGeo, bondMat);

  const mid = new THREE.Vector3()
    .addVectors(m1.position, m2.position)
    .multiplyScalar(0.5);

  bond.position.copy(mid);
  bond.lookAt(m2.position);
  bond.rotateX(Math.PI/2);
  bond.scale.y = m1.position.distanceTo(m2.position);

  dna.add(bond);
  bonds.push(bond);
}

/* ===== MODE ===== */
let mode = "twist";
let t = 0;

/* ===== TOUCH / MOUSE ROTATE ===== */
let down=false, lastX=0;
addEventListener("mousedown",e=>{down=true; lastX=e.clientX});
addEventListener("mouseup",()=>down=false);
addEventListener("mousemove",e=>{
  if(down){
    dna.rotation.y += (e.clientX-lastX)*0.005;
    lastX=e.clientX;
  }
});

addEventListener("touchstart",e=>lastX=e.touches[0].clientX);
addEventListener("touchmove",e=>{
  const dx=e.touches[0].clientX-lastX;
  dna.rotation.y += dx*0.005;
  lastX=e.touches[0].clientX;
});

/* ===== ANIMATE ===== */
function animate(){
  requestAnimationFrame(animate);

  if(mode==="twist"){
    dna.rotation.y += 0.004;
    bonds.forEach(b=>{
      b.material.opacity = 0.9;
      b.scale.y = 1;
    });
  }

  if(mode==="open"){
    t = Math.min(t+0.01,1);
    chainA.forEach((b,i)=> b.position.x = Math.cos(i*STEP)*R - t*4);
    chainB.forEach((b,i)=> b.position.x = Math.cos(i*STEP+Math.PI)*R + t*4);
    bonds.forEach(b=>{
      b.material.opacity = 1-t;
      b.scale.y = 1-t;
    });
  }

  if(mode==="copy"){
    t = Math.max(t-0.01,0);
  }

  renderer.render(scene,camera);
}
animate();

addEventListener("resize",()=>{
  camera.aspect=innerWidth/innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(innerWidth,innerHeight);
});
</script>
</body>
</html>
