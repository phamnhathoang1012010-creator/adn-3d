<script src="https://cdn.jsdelivr.net/npm/three@0.152.2/build/three.min.js"></script>
<script>
/* ===== SCENE ===== */
const scene = new THREE.Scene();
scene.background = new THREE.Color(0x000000);

const camera = new THREE.PerspectiveCamera(
  75, window.innerWidth / window.innerHeight, 0.1, 1000
);
camera.position.z = 30;

const renderer = new THREE.WebGLRenderer({ antialias: true });
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);

/* ===== LIGHT ===== */
scene.add(new THREE.AmbientLight(0xffffff, 0.8));
const light = new THREE.DirectionalLight(0xffffff, 1);
light.position.set(5,10,10);
scene.add(light);

/* ===== DNA STRANDS ===== */
const strandLeft = new THREE.Group();   // mạch quay
const strandRight = new THREE.Group();  // mạch khuôn đứng yên
scene.add(strandLeft, strandRight);

const bases = 18;

/* Nhánh 1 – mạch quay */
for(let i=0;i<bases;i++){
  const b = new THREE.Mesh(
    new THREE.BoxGeometry(0.8,0.8,0.8),
    new THREE.MeshStandardMaterial({color:0xffc107})
  );
  b.position.set(
    Math.sin(i*0.5)*2 - 4,
    i - bases/2,
    Math.cos(i*0.5)
  );
  strandLeft.add(b);
}

/* Nhánh 2 – mạch khuôn (ĐỨNG YÊN) */
for(let i=0;i<bases;i++){
  const b = new THREE.Mesh(
    new THREE.BoxGeometry(0.8,0.8,0.8),
    new THREE.MeshStandardMaterial({color:0x2196f3})
  );
  b.position.set(6, i - bases/2, 0);
  strandRight.add(b);
}

/* ===== HELICASE ===== */
const helicase = new THREE.Group();

// lõi enzyme
const core = new THREE.Mesh(
  new THREE.CylinderGeometry(1.2,1.2,1,32),
  new THREE.MeshStandardMaterial({color:0x7cb342})
);

// 2 nucleotide bị ôm
const hL = new THREE.Mesh(
  new THREE.BoxGeometry(0.6,0.6,0.6),
  new THREE.MeshStandardMaterial({color:0xff9800})
);
hL.position.x = -1;

const hR = hL.clone();
hR.position.x = 1;

helicase.add(core, hL, hR);
scene.add(helicase);

/* ===== OKAZAKI ===== */
const okazaki = new THREE.Group();
scene.add(okazaki);

for(let i=0;i<6;i++){
  const f = new THREE.Mesh(
    new THREE.BoxGeometry(0.7,0.7,0.7),
    new THREE.MeshStandardMaterial({color:0xff5722})
  );
  f.position.set(4, -10 - i*1.2, 0);
  okazaki.add(f);
}

/* ===== LIGASE ===== */
const ligase = new THREE.Mesh(
  new THREE.SphereGeometry(0.8,32,32),
  new THREE.MeshStandardMaterial({color:0x9c27b0})
);
ligase.position.set(4,-12,0);
scene.add(ligase);

/* ===== LABEL ===== */
const info = document.createElement("div");
info.style.position="fixed";
info.style.top="10px";
info.style.left="10px";
info.style.color="white";
info.innerHTML = `
<b>Nhánh 1:</b> bị tháo xoắn – quay<br>
<b>Nhánh 2:</b> mạch khuôn (3' → 5')<br>
<b>Helicase:</b> tháo xoắn ADN<br>
<b>Mạch sau:</b> đoạn Okazaki
`;
document.body.appendChild(info);

/* ===== ANIMATION ===== */
function animate(){
  requestAnimationFrame(animate);

  // Nhánh 1 quay
  strandLeft.rotation.y += 0.01;

  // Helicase di chuyển
  helicase.position.y += 0.05;
  if(helicase.position.y > 10) helicase.position.y = -10;

  // Tách mạch tại vị trí helicase
  strandLeft.children.forEach(b=>{
    if(Math.abs(b.position.y - helicase.position.y) < 0.6){
      b.position.x -= 0.03;
    }
  });
  strandRight.children.forEach(b=>{
    if(Math.abs(b.position.y - helicase.position.y) < 0.6){
      b.position.x += 0.03;
    }
  });

  // Okazaki hình thành phía sau helicase
  okazaki.children.forEach(f=>{
    if(f.position.y < helicase.position.y){
      f.position.y += 0.03;
    }
  });

  // Ligase nối Okazaki
  ligase.position.y += 0.03;
  okazaki.children.forEach(f=>{
    if(Math.abs(f.position.y - ligase.position.y) < 0.5){
      f.material.color.set(0x4caf50); // đã nối
    }
  });

  renderer.render(scene,camera);
}
animate();
</script>
