<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>M√¥ ph·ªèng t√°i b·∫£n ADN ‚Äì SGK</title>

<style>
body{
  margin:0;
  background:black;
  overflow:hidden;
  color:white;
  font-family:Arial;
}
#legend{
  position:fixed;
  top:10px;
  left:10px;
  font-size:14px;
}
#ui{
  position:fixed;
  bottom:10px;
  left:50%;
  transform:translateX(-50%);
}
button{
  padding:8px 14px;
  margin:4px;
  border:none;
  border-radius:10px;
  background:#444;
  color:white;
  cursor:pointer;
}
button.active{
  background:#2ecc71;
  color:black;
}
</style>
</head>

<body>

<div id="legend">
üü° A &nbsp; üîµ T &nbsp; üü• G &nbsp; üü¢ C<br>
Nh√°nh 1: th√°o xo·∫Øn ‚Äì t·ªïng h·ª£p<br>
Nh√°nh 2: m·∫°ch khu√¥n (3‚Äô ‚Üí 5‚Äô)
</div>

<div id="ui">
<button id="s1" class="active">B∆∞·ªõc 1</button>
<button id="s2">B∆∞·ªõc 2</button>
<button id="s3">B∆∞·ªõc 3</button>
</div>

<script src="https://cdn.jsdelivr.net/npm/three@0.152.2/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.152.2/examples/js/controls/OrbitControls.js"></script>

<script>
// ===== SCENE =====
const scene = new THREE.Scene();
scene.background = new THREE.Color(0x000000);

const camera = new THREE.PerspectiveCamera(60,innerWidth/innerHeight,0.1,1000);
camera.position.set(0,0,25);

const renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(innerWidth,innerHeight);
document.body.appendChild(renderer.domElement);

// ===== CONTROLS =====
const controls = new THREE.OrbitControls(camera,renderer.domElement);
controls.enablePan = false;
controls.update();

// ===== RESIZE =====
window.onresize=()=>{
  camera.aspect=innerWidth/innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(innerWidth,innerHeight);
};

// ===== LIGHT =====
scene.add(new THREE.AmbientLight(0xffffff,0.8));
const dl=new THREE.DirectionalLight(0xffffff,1);
dl.position.set(5,10,5);
scene.add(dl);

// ===== DNA =====
const branch1=new THREE.Group(); // leading
const branch2=new THREE.Group(); // template
scene.add(branch1,branch2);

const pairs=[];
const total=14;

for(let i=0;i<total;i++){
  const left=new THREE.Mesh(
    new THREE.BoxGeometry(0.8,0.8,0.8),
    new THREE.MeshStandardMaterial({color:0xf1c40f})
  );
  const right=new THREE.Mesh(
    new THREE.BoxGeometry(0.8,0.8,0.8),
    new THREE.MeshStandardMaterial({color:0x3498db})
  );

  const y=6-i*1.0;
  left.position.set(0,y,0);
  right.position.set(0,y,0);

  branch1.add(left);
  branch2.add(right);
  pairs.push({left,right,y});
}

// ===== HELICASE =====
const helicase=new THREE.Mesh(
  new THREE.CylinderGeometry(1.1,1.1,0.8,32),
  new THREE.MeshStandardMaterial({color:0x2ed573})
);
helicase.position.set(0,7,0);
helicase.visible=false;
scene.add(helicase);

// ===== OKAZAKI =====
const okazaki=new THREE.Group();
for(let i=0;i<5;i++){
  const f=new THREE.Mesh(
    new THREE.BoxGeometry(0.7,0.7,0.7),
    new THREE.MeshStandardMaterial({color:0xff6b6b})
  );
  f.position.set(3,-6-i,0);
  okazaki.add(f);
}
okazaki.visible=false;
scene.add(okazaki);

// ===== STEP CONTROL =====
let step=1;
s1.onclick=()=>{step=1;updateStep();}
s2.onclick=()=>{step=2;updateStep();}
s3.onclick=()=>{step=3;updateStep();}

function updateStep(){
  s1.classList.toggle("active",step===1);
  s2.classList.toggle("active",step===2);
  s3.classList.toggle("active",step===3);

  helicase.visible = step>=2;
  okazaki.visible = step>=3;
}
updateStep();

// ===== ANIMATION =====
function animate(){
  requestAnimationFrame(animate);

  if(step>=2){
    helicase.position.y -= 0.02;

    pairs.forEach(p=>{
      if(p.y > helicase.position.y){
        p.left.position.x = -2;   // nh√°nh 1 t√°ch
        p.right.position.x = 2;   // nh√°nh 2 t√°ch
      }
    });
  }

  if(step>=3){
    okazaki.children.forEach(o=>{
      o.position.y += 0.02;
      if(o.position.y>1) o.position.y=-6;
    });
  }

  controls.update();
  renderer.render(scene,camera);
}
animate();
</script>

</body>
</html>
