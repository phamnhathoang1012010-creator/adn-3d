<!DOCTYPE html><html lang="vi">
<head>
<meta charset="UTF-8" />
<title>DNA 3D – Xoắn / Tháo / Nhân đôi</title>
<style>
body{margin:0;overflow:hidden;background:#000;font-family:Arial}
#ui{position:fixed;top:10px;left:10px;z-index:10;display:flex;gap:8px;flex-wrap:wrap}
button{padding:8px 14px;border:0;border-radius:6px;background:#1e90ff;color:#fff}
input[type=range]{width:150px}
.label{color:#fff;font-size:12px}
canvas{touch-action:none;}
</style>
</head>
<body>
<div id="ui">
<button onclick="setMode('twist')">Xoắn</button>
<button onclick="setMode('unzip')">Tháo</button>
<button onclick="setMode('replicate')">Nhân đôi</button>
<div class="label">Enzyme</div>
<input id="enzyme" type="range" min="0" max="1" step="0.01" value="0" />
<div class="label">rDNA</div>
<input id="rdna" type="range" min="0" max="1" step="0.01" value="0" />
</div><script src="https://cdn.jsdelivr.net/npm/three@0.158/build/three.min.js"></script><script src="https://cdn.jsdelivr.net/npm/three@0.158/examples/js/controls/OrbitControls.js"></script><script>
// SCENE
const scene=new THREE.Scene();
const camera=new THREE.PerspectiveCamera(60,innerWidth/innerHeight,0.1,1000);
camera.position.z=38;
const renderer=new THREE.WebGLRenderer({antialias:true});
renderer.setSize(window.innerWidth, window.innerHeight);
renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
document.body.appendChild(renderer.domElement);

const controls=new THREE.OrbitControls(camera,renderer.domElement);
controls.enableDamping=true;
controls.enablePan=false;

scene.add(new THREE.AmbientLight(0xffffff,0.6));
const d=new THREE.DirectionalLight(0xffffff,0.8);
d.position.set(10,20,10);scene.add(d);

// DNA
const colors={A:0xff4d4d,T:0x4d79ff,G:0x4dff88,C:0xffd24d};
const pair={A:'T',T:'A',G:'C',C:'G'};
const bases=['A','T','G','C','T','A','C','G','A','T','G','C'];

const dna=new THREE.Group();scene.add(dna);
let bonds=[];let hydros=[];

function buildDNA(){
const R=7,step=2.3,tw=0.65;
bases.forEach((b,i)=>{
const a=i*tw,y=i*step-bases.length;
// backbone
['L','R'].forEach((s,j)=>{
const cyl=new THREE.Mesh(new THREE.CylinderGeometry(0.15,0.15,step,8),new THREE.MeshStandardMaterial({color:0xffffff}));
const ang=a+(j?Math.PI:0);
cyl.position.set(Math.cos(ang)*R,y,Math.sin(ang)*R);
cyl.rotation.z=Math.PI/2;dna.add(cyl);
});
// bases
const g=new THREE.SphereGeometry(0.65,16,16);
const bl=new THREE.Mesh(g,new THREE.MeshStandardMaterial({color:colors[b]}));
const br=new THREE.Mesh(g,new THREE.MeshStandardMaterial({color:colors[pair[b]]}));
bl.position.set(Math.cos(a)*(R-1.3),y,Math.sin(a)*(R-1.3));
br.position.set(Math.cos(a+Math.PI)*(R-1.3),y,Math.sin(a+Math.PI)*(R-1.3));
dna.add(bl,br);
// hydrogen bond
const bond=new THREE.Mesh(new THREE.CylinderGeometry(0.08,0.08,R*1.8,6),new THREE.MeshStandardMaterial({color:0x88ffff,transparent:true,opacity:0.6}));
bond.position.set(0,y,0);bond.rotation.z=Math.PI/2;dna.add(bond);bonds.push(bond);
// hydrogen particles
for(let k=-2;k<=2;k++){
const h=new THREE.Mesh(new THREE.SphereGeometry(0.18,8,8),new THREE.MeshStandardMaterial({color:0x00ffff,emissive:0x008888}));
h.position.set(Math.cos(a)*k,y,Math.sin(a)*k);
dna.add(h);hydros.push(h);
}
});
}
buildDNA();

let mode='twist';
function setMode(m){mode=m;}

function animate(){function animate(){
  requestAnimationFrame(animate);
  renderer.render(scene, camera);
}
animate();

window.addEventListener('resize',()=>{
  camera.aspect = window.innerWidth / window.innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(window.innerWidth, window.innerHeight);
});

requestAnimationFrame(animate);
if(mode==='twist') dna.rotation.y+=0.01;
if(mode==='unzip') bonds.forEach((b,i)=>b.scale.x=1-document.getElementById('enzyme').value);
if(mode==='replicate') hydros.forEach(h=>h.visible=document.getElementById('rdna').value>0.5);
controls.update();renderer.render(scene,camera);}
animate();

onresize=()=>{camera.aspect=innerWidth/innerHeight;camera.updateProjectionMatrix();renderer.setSize(innerWidth,innerHeight)}
</script></body>
</html>
