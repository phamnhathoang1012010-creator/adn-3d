<script>
/* ===== SCENE ===== */
const scene = new THREE.Scene();
scene.background = new THREE.Color(0x000000);

const camera = new THREE.PerspectiveCamera(70, innerWidth/innerHeight, 0.1, 1000);
camera.position.set(0, 0, 40);

const renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(innerWidth, innerHeight);
document.body.appendChild(renderer.domElement);

/* ===== CONTROLS ===== */
const controls = new THREE.OrbitControls(camera, renderer.domElement);
controls.enableDamping = true;

/* ===== LIGHT ===== */
scene.add(new THREE.AmbientLight(0xffffff,0.9));
const light = new THREE.DirectionalLight(0xffffff,1);
light.position.set(10,10,10);
scene.add(light);

/* ===== COLORS BASE ===== */
const baseColor = {
  A:0xf1c40f, // vàng
  T:0x3498db, // xanh dương
  G:0xe74c3c, // đỏ
  C:0x2ecc71  // xanh lá
};

/* ===== DNA STRANDS ===== */
const branch1 = new THREE.Group(); // bị tháo xoắn
const branch2 = new THREE.Group(); // mạch khuôn
scene.add(branch1, branch2);

const sequence = ["A","T","G","C","A","G","T","C","A","T","G","C"];

sequence.forEach((b,i)=>{
  const geo = new THREE.SphereGeometry(0.45,16,16);

  const m1 = new THREE.MeshStandardMaterial({color:baseColor[b]});
  const n1 = new THREE.Mesh(geo,m1);
  n1.position.set(Math.sin(i*0.5)*3, i-6, Math.cos(i*0.5)*3);
  branch1.add(n1);

  const m2 = new THREE.MeshStandardMaterial({color:baseColor[b]});
  const n2 = new THREE.Mesh(geo,m2);
  n2.position.set(6, i-6, 0);
  branch2.add(n2);
});

/* ===== HELICASE ===== */
const helicase = new THREE.Mesh(
  new THREE.TorusGeometry(1.6,0.4,16,32),
  new THREE.MeshStandardMaterial({color:0x7bed9f})
);
helicase.visible = false;
scene.add(helicase);

/* ===== OKAZAKI ===== */
const okazaki = new THREE.Group();
for(let i=0;i<4;i++){
  const o = new THREE.Mesh(
    new THREE.SphereGeometry(0.35,16,16),
    new THREE.MeshStandardMaterial({color:0xff8c42})
  );
  o.position.set(4,-8-i*1.2,0);
  okazaki.add(o);
}
okazaki.visible = false;
scene.add(okazaki);

/* ===== STEP CONTROL ===== */
let step = 1;
s1.onclick=()=>{step=1;update()};
s2.onclick=()=>{step=2;update()};
s3.onclick=()=>{step=3;update()};

function update(){
  helicase.visible = step>=2;
  okazaki.visible = step>=3;
}
update();

/* ===== ANIMATE ===== */
function animate(){
  requestAnimationFrame(animate);

  if(step>=2){
    branch1.rotation.y += 0.01; // tháo xoắn
    helicase.position.y += 0.04;
    if(helicase.position.y>6) helicase.position.y=-6;
  }

  if(step>=3){
    okazaki.children.forEach(o=>{
      o.position.y += 0.015;
      if(o.position.y>1) o.position.y=-8;
    });
  }

  controls.update();
  renderer.render(scene,camera);
}
animate();
</script>
