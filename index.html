<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Mô phỏng ADN – Sinh học</title>
<style>
body{margin:0;background:black;color:white;overflow:hidden;font-family:Arial}
#ui{
  position:fixed;top:0;width:100%;
  background:rgba(0,0,0,.85);
  padding:8px;display:flex;gap:8px;
  align-items:center;z-index:10;flex-wrap:wrap
}
button{padding:6px 10px;border:0;border-radius:6px;background:#2196f3;color:white}
</style>
</head>
<body>

<div id="ui">
  <button onclick="mode='structure'">Nhánh 1: ADN xoắn</button>
  <button onclick="mode='replication'">Nhánh 2: Tháo xoắn ADN</button>
  <label>Helicase
    <input type="range" min="0" max="5" step="1" value="0"
           oninput="enzyme=parseInt(this.value)">
  </label>
  <span style="color:red">A</span>
  <span style="color:lime">T</span>
  <span style="color:deepskyblue">G</span>
  <span style="color:yellow">C</span>
</div>

<script src="https://cdn.jsdelivr.net/npm/three@0.152/build/three.min.js"></script>
<script>
let scene=new THREE.Scene();
let camera=new THREE.PerspectiveCamera(60,innerWidth/innerHeight,.1,1000);
camera.position.z=40;

let renderer=new THREE.WebGLRenderer({antialias:true});
renderer.setSize(innerWidth,innerHeight);
document.body.appendChild(renderer.domElement);

window.onresize=()=>{
  camera.aspect=innerWidth/innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(innerWidth,innerHeight);
};

scene.add(new THREE.AmbientLight(0xffffff,.7));
let light=new THREE.PointLight(0xffffff,1);
light.position.set(20,20,20);
scene.add(light);

let mode="structure";
let enzyme=0;

const colors={A:0xff0000,T:0x00ff00,G:0x00bfff,C:0xffff00};
const pairs={A:"T",T:"A",G:"C",C:"G"};
const bases=["A","T","G","C"];

let dnaGroup=new THREE.Group();
scene.add(dnaGroup);

let basesData=[];

function buildDNA(){
  dnaGroup.clear();
  basesData=[];
  for(let i=0;i<6;i++){
    let b=bases[Math.floor(Math.random()*4)];
    let p=pairs[b];
    let y=i*4-10;
    let angle=i*0.6;

    [b,p].forEach((base,side)=>{
      let mesh=new THREE.Mesh(
        new THREE.SphereGeometry(.8,24,24),
        new THREE.MeshStandardMaterial({color:colors[base]})
      );
      let x=Math.cos(angle+side*Math.PI)*6;
      let z=Math.sin(angle+side*Math.PI)*6;
      mesh.position.set(x,y,z);
      dnaGroup.add(mesh);

      basesData.push({
        mesh, side, pair:i,
        baseX:x
      });
    });
  }
}
buildDNA();

/* HELICASE */
let helicase=new THREE.Mesh(
  new THREE.TorusGeometry(3.5,.6,16,80),
  new THREE.MeshStandardMaterial({color:0xff00ff})
);
scene.add(helicase);
helicase.visible=false;

function animate(){
  requestAnimationFrame(animate);

  if(mode==="structure"){
    dnaGroup.rotation.y+=0.01;
    helicase.visible=false;

    basesData.forEach(b=>{
      b.mesh.position.x=b.baseX;
    });
  }

  if(mode==="replication"){
    dnaGroup.rotation.y=Math.PI/2;
    helicase.visible=true;
    helicase.position.set(0,enzyme*4-10,0);

    basesData.forEach(b=>{
      if(b.pair<=enzyme){
        b.mesh.position.x=b.baseX+(b.side===0?-4:4);
      }else{
        b.mesh.position.x=b.baseX;
      }
    });
  }

  renderer.render(scene,camera);
}
animate();
</script>
</body>
</html>
