<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Mô phỏng tái bản ADN</title>
<style>
body{margin:0;background:black;overflow:hidden;font-family:sans-serif}
#ui{
 position:fixed;top:10px;left:10px;color:white;font-size:14px
}
button{margin:4px;padding:6px}
.legend span{margin-right:10px}
</style>
</head>

<body>
<div id="ui">
 <b>Mô phỏng tái bản ADN</b><br>
 <button onclick="mode=1">Nhánh 1: Xoay ADN</button>
 <button onclick="mode=2">Nhánh 2: Tái bản</button>
 <div class="legend">
  <span style="color:red">A</span>
  <span style="color:yellow">T</span>
  <span style="color:green">G</span>
  <span style="color:cyan">C</span>
 </div>
 <div>Chiều tổng hợp: 3’ → 5’</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/three@0.152.2/build/three.min.js"></script>

<script>
let scene=new THREE.Scene();
let camera=new THREE.PerspectiveCamera(70,innerWidth/innerHeight,0.1,1000);
camera.position.z=35;

let renderer=new THREE.WebGLRenderer({antialias:true});
renderer.setSize(innerWidth,innerHeight);
document.body.appendChild(renderer.domElement);

let light=new THREE.PointLight(0xffffff,1);
light.position.set(20,20,20);
scene.add(light);

let mode=1;

// ==== BASE COLORS ====
const baseColor={A:0xff0000,T:0xffff00,G:0x00ff00,C:0x00ffff};

// ==== ADN XOẮN ====
const helix=new THREE.Group();
for(let i=0;i<12;i++){
 let a=i*0.5;
 let x=Math.cos(a)*5;
 let y=i*2-12;
 let z=Math.sin(a)*5;
 let b1=new THREE.Mesh(
  new THREE.SphereGeometry(0.8),
  new THREE.MeshStandardMaterial({color:Object.values(baseColor)[i%4]})
 );
 let b2=b1.clone();
 b1.position.set(x,y,z);
 b2.position.set(-x,y,-z);
 helix.add(b1,b2);
}
scene.add(helix);

// ==== ENZYME THÁO XOẮN ====
const helicase=new THREE.Mesh(
 new THREE.TorusGeometry(2,0.6,16,50),
 new THREE.MeshStandardMaterial({color:0x9e9e9e})
);
helicase.position.y=6;
scene.add(helicase);

// ==== NHÁNH TÁI BẢN (ĐỨNG YÊN) ====
const okazaki=new THREE.Group();
for(let i=0;i<6;i++){
 let f=new THREE.Mesh(
  new THREE.BoxGeometry(1.5,1,1),
  new THREE.MeshStandardMaterial({color:0xff9800})
 );
 f.position.set(8,i*2-6,0);
 okazaki.add(f);
}
scene.add(okazaki);

// ==== DNA POLYMERASE ====
const polymerase=new THREE.Mesh(
 new THREE.CylinderGeometry(1.2,1.2,2,32),
 new THREE.MeshStandardMaterial({color:0x2196f3})
);
polymerase.position.set(8,-8,0);
scene.add(polymerase);

// ==== LIGASE ====
const ligase=new THREE.Mesh(
 new THREE.SphereGeometry(1.2),
 new THREE.MeshStandardMaterial({color:0x9c27b0})
);
ligase.position.set(8,-12,0);
scene.add(ligase);

function animate(){
 requestAnimationFrame(animate);

 if(mode===1){
  helix.rotation.y+=0.01;   // Nhánh 1 xoay
  helicase.position.y-=0.02;
  if(helicase.position.y<-6) helicase.position.y=6;
 }

 if(mode===2){
  polymerase.position.y+=0.03;
  ligase.position.y+=0.03;

  okazaki.children.forEach(o=>{
   if(Math.abs(o.position.y-ligase.position.y)<0.8){
    o.material.color.set(0x4caf50); // Okazaki đã nối
   }
  });

  if(polymerase.position.y>6){
   polymerase.position.y=-8;
   ligase.position.y=-12;
  }
 }

 renderer.render(scene,camera);
}
animate();
</script>
</body>
</html>
