<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Mô phỏng ADN – Sinh học</title>
<style>
body {
  margin: 0;
  background: black;
  color: white;
  font-family: Arial, sans-serif;
  overflow: hidden;
}
#ui {
  position: fixed;
  top: 0;
  width: 100%;
  background: rgba(0,0,0,0.85);
  padding: 8px;
  display: flex;
  gap: 10px;
  align-items: center;
  z-index: 10;
}
button {
  padding: 6px 10px;
  border-radius: 6px;
  border: none;
  background: #2196f3;
  color: white;
}
</style>
</head>
<body>

<div id="ui">
  <button onclick="mode='structure'">Nhánh 1: ADN xoắn</button>
  <button onclick="mode='replication'">Nhánh 2: Tháo xoắn ADN</button>
  <label>Helicase
    <input type="range" min="0" max="1" step="0.01"
           oninput="enzyme=this.value">
  </label>
  <span style="color:red">A</span>
  <span style="color:lime">T</span>
  <span style="color:deepskyblue">G</span>
  <span style="color:yellow">C</span>
</div>

<script src="https://cdn.jsdelivr.net/npm/three@0.152/build/three.min.js"></script>
<script>
let scene = new THREE.Scene();
let camera = new THREE.PerspectiveCamera(60, innerWidth/innerHeight, 0.1, 1000);
camera.position.z = 40;

let renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(innerWidth, innerHeight);
document.body.appendChild(renderer.domElement);

window.onresize = () => {
  camera.aspect = innerWidth/innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(innerWidth, innerHeight);
};

scene.add(new THREE.AmbientLight(0xffffff,0.6));
let light = new THREE.PointLight(0xffffff,1);
light.position.set(20,20,20);
scene.add(light);

let mode = "structure";
let enzyme = 0;

const colors = {A:0xff0000,T:0x00ff00,G:0x00bfff,C:0xffff00};
const pairs = {A:"T",T:"A",G:"C",C:"G"};
const bases = ["A","T","G","C"];

let dnaGroup = new THREE.Group();
scene.add(dnaGroup);

let spheres = [];

function buildDNA(){
  dnaGroup.clear();
  spheres = [];
  for(let i=0;i<6;i++){
    let b = bases[Math.floor(Math.random()*4)];
    let p = pairs[b];
    let y = i*4 - 10;
    let angle = i*0.6;
    [b,p].forEach((base,side)=>{
      let s = new THREE.Mesh(
        new THREE.SphereGeometry(0.8,32,32),
        new THREE.MeshStandardMaterial({color:colors[base]})
      );
      s.position.set(
        Math.cos(angle+side*Math.PI)*6,
        y,
        Math.sin(angle+side*Math.PI)*6
      );
      dnaGroup.add(s);
      spheres.push({mesh:s, side, pair:i});
    });
  }
}
buildDNA();

/* ===== HELICASE (ENZYME THÁO XOẮN) ===== */
let helicase = new THREE.Mesh(
  new THREE.TorusGeometry(3.5,0.6,16,100),
  new THREE.MeshStandardMaterial({color:0xff00ff})
);
scene.add(helicase);
helicase.visible = false;

/* ========== ANIMATION ========== */
function animate(){
  requestAnimationFrame(animate);

  if(mode==="structure"){
    dnaGroup.rotation.y += 0.01;
    helicase.visible = false;
  }

  if(mode==="replication"){
    dnaGroup.rotation.y = Math.PI/2;
    helicase.visible = true;

    let activePair = Math.floor(enzyme * 6);
    helicase.position.set(0, activePair*4 - 10, 0);

    spheres.forEach(o=>{
      if(o.pair <= activePair){
        o.mesh.position.x += (o.side===0?-1:1)*0.03;
      }
    });
  }

  renderer.render(scene,camera);
}
animate();
</script>

</body>
</html>
